(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n(o.BrowserCache={}))})(this,function(o){"use strict";var L=Object.defineProperty,Y=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var b=(o,n,u)=>n in o?L(o,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[n]=u,E=(o,n)=>{for(var u in n||(n={}))$.call(n,u)&&b(o,u,n[u]);if(C)for(var u of C(n))q.call(n,u)&&b(o,u,n[u]);return o},P=(o,n)=>Y(o,z(n));var m=(o,n,u)=>(b(o,typeof n!="symbol"?n+"":n,u),u);var n={driver:"memory"};class u{get(){throw new Error("please implement the get method for this driver.")}set(){throw new Error("please implement the set method for this driver.")}}const S={OK:Symbol("OK"),KEY_NOT_EXISTS:Symbol("KEY_NOT_EXISTS"),KEY_EXPIRED:Symbol("KEY_EXPIRED"),JSON_PARSE_ERROR:Symbol("JSON_PARSE_ERROR"),NX_SET_NOT_PERFORMED:Symbol("NX_SET_NOT_PERFORMED"),XX_SET_NOT_PERFORMED:Symbol("XX_SET_NOT_PERFORMED")};class v extends u{keyValueGet(){throw new Error("please implement the keyValueGet method for this driver.")}keyValueSet(){throw new Error("please implement the keyValueSet method for this driver.")}existsKey(){throw new Error("please implement the existsKey method for this driver.")}get(e){const t=this.keyValueGet(e);if(t)try{const l=JSON.parse(t);if(l.expiredAt){if(l.expiredAt>Date.now())return l.value;this.$emit("cacheExpired",e);return}else return l.value}catch(l){window.console.debug("get key json parse error",l);return}}set(e,t,l={}){const{EX:i,PX:a,EXAT:s,PXAT:f,NX:h=!1,XX:g=!1,GET:d=!1}=l;let c,y;if(i&&typeof i=="number"&&i>0&&(c=Date.now()+i*1e3),a&&typeof a=="number"&&a>0&&(c=Date.now()+a),s&&typeof s=="number"&&s>0&&(c=s*1e3),f&&typeof f=="number"&&f>0&&(c=f),c&&(y=Math.max(c-Date.now(),0)),h||g||d){const p=this.get(e),O=this.existsKey(e);return h&&O?d?p:S.NX_SET_NOT_PERFORMED:g&&!O?d?p:S.XX_SET_NOT_PERFORMED:(this.keyValueSet(e,JSON.stringify({value:t,expiredAt:c,maxAge:y})),d?p:S.OK)}else return this.keyValueSet(e,JSON.stringify({value:t,expiredAt:c,maxAge:y})),S.OK}}class N extends v{keyValueGet(e){return localStorage.getItem(e)}keyValueSet(e,t){localStorage.setItem(e,t)}existsKey(e){return!!localStorage.getItem(e)}}m(N,"driver","localStorage");class V extends v{constructor(){super(...arguments);m(this,"data",new Map)}keyValueGet(t){return this.data.get(t)}keyValueSet(t,l){this.data.set(t,l)}existsKey(t){return!!this.data.has(t)}}m(V,"driver","memory");class j extends v{keyValueGet(e){return sessionStorage.getItem(e)}keyValueSet(e,t){sessionStorage.setItem(e,t)}existsKey(e){return!!sessionStorage.getItem(e)}}m(j,"driver","sessionStorage");/*! js-cookie v3.0.1 | MIT */function x(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var l in t)r[l]=t[l]}return r}var I={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function R(r,e){function t(i,a,s){if(typeof document!="undefined"){s=x({},e,s),typeof s.expires=="number"&&(s.expires=new Date(Date.now()+s.expires*864e5)),s.expires&&(s.expires=s.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var f="";for(var h in s)!s[h]||(f+="; "+h,s[h]!==!0&&(f+="="+s[h].split(";")[0]));return document.cookie=i+"="+r.write(a,i)+f}}function l(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var a=document.cookie?document.cookie.split("; "):[],s={},f=0;f<a.length;f++){var h=a[f].split("="),g=h.slice(1).join("=");try{var d=decodeURIComponent(h[0]);if(s[d]=r.read(g,d),i===d)break}catch{}}return i?s[i]:s}}return Object.create({set:t,get:l,remove:function(i,a){t(i,"",x({},a,{expires:-1}))},withAttributes:function(i){return R(this.converter,x({},this.attributes,i))},withConverter:function(i){return R(x({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var D=R(I,{path:"/"});class K extends v{keyValueGet(e){return D.get(e)}keyValueSet(e,t){D.set(e,t)}existsKey(e){return!!D.get(e)}}m(K,"driver","cookie");class M extends u{keyValueGet(){return Promise.reject(new Error("please implement the keyValueGet method for this driver."))}keyValueSet(){return Promise.reject(new Error("please implement the keyValueSet method for this driver."))}existsKey(){return Promise.reject(new Error("please implement the existsKey method for this driver."))}get(e){return new Promise((t,l)=>{this.keyValueGet(e).then(i=>{if(i)try{const a=JSON.parse(i);a.expiredAt?a.expiredAt>Date.now()?t(a.value):(this.$emit("cacheExpired",e),t()):t(a.value)}catch(a){window.console.debug("get key json parse error",a),t()}else t()}).catch(i=>{l(i)})})}set(e,t,l={}){const{EX:i,PX:a,EXAT:s,PXAT:f,NX:h=!1,XX:g=!1,GET:d=!1}=l;let c,y;return i&&typeof i=="number"&&i>0&&(c=Date.now()+i*1e3),a&&typeof a=="number"&&a>0&&(c=Date.now()+a),s&&typeof s=="number"&&s>0&&(c=s*1e3),f&&typeof f=="number"&&f>0&&(c=f),c&&(y=Math.max(c-Date.now(),0)),new Promise((p,O)=>{if(h||g||d){const X=this.get(e),J=this.existsKey(e);Promise.all([X,J]).then(([_,A])=>{if(h&&A)return p(d?_:S.NX_SET_NOT_PERFORMED);if(g&&!A)return p(d?_:S.XX_SET_NOT_PERFORMED);this.keyValueSet(e,JSON.stringify({value:t,expiredAt:c,maxAge:y})).then(()=>p(d?_:S.OK)).catch(U=>{O(U)})}).catch(_=>{O(_)})}else this.keyValueSet(e,JSON.stringify({value:t,expiredAt:c,maxAge:y})).then(()=>p(S.OK)).catch(X=>{O(X)})})}}const w={};for(const r of[V,N,j,K])w[r.driver]=r;const T={},B=r=>{if(Object.getPrototypeOf(r)===u)if(r.driver&&typeof r.driver=="string")T[r.driver]=r;else throw new Error("please input the driver name.")},k=()=>{let r=["memory"];return window.localStorage&&w.localStorage&&r.push("localStorage"),window.sessionStorage&&w.sessionStorage&&r.push("sessionStorage"),window.document.cookie&&w.cookie&&r.push("cookie"),window.indexedDB&&w.indexedDB&&r.push("indexedDB"),r=r.concat(Object.keys(T)),r},G=r=>w[r]||T[r];class F{constructor(e,t){m(this,"opts");m(this,"__init",!1);m(this,"driver");m(this,"store");const l=k();if(!e&&!t)t=E({},n);else if(e)if(l.includes(e))Object.prototype.toString.call(t)==="[object Object]"?t=E(P(E({},n),{driver:e}),t):t=P(E({},n),{driver:e});else if(Object.prototype.toString.call(e)==="[object Object]"&&l.includes(e.driver))t=E(E({},n),e);else throw new Error("please input the correct driver param as the first param or in the opts params.");else throw new Error("please input the driver as first param.");if(t&&t.driver)this.opts=t,this.initDriver(),this.__init=!0;else throw new Error("please input the driver as first param.")}initDriver(){const e=k();if(!this.store&&this.opts&&this.opts.driver&&e.includes(this.opts.driver)){const t=G(this.opts.driver);this.store=new t(this.opts),this.driver=this.opts.driver}}setDriver(e){this.opts.driver=e,this.initDriver()}get(){return this.store.get.apply(this.store,arguments)}set(){return this.store.set.apply(this.store,arguments)}existsKey(){return this.store.existsKey.apply(this.store,arguments)}}o.AsyncStore=M,o.BaseStore=u,o.BrowserCache=F,o.StoreResult=S,o.SyncStore=v,o.registerStore=B,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
